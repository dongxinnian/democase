<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
		*{
			margin: 0;
			padding: 0;
		}
			body{
				overflow: hidden;
			}
			#myCanvas{
				border: 1px;
				background-color: #fff;
			}
		</style>
	</head>
	<body>
		<canvas id="myCanvas"></canvas>
	</body>
	<script type="text/javascript">
		//获取窗口宽高
		var w = window.innerWidth;
		var h = window.innerHeight;
		
		var canvas = document.getElementById("myCanvas");
		var ctx = canvas.getContext("2d");
		//设置画布宽高与窗口宽高一样
		canvas.width = w;
		canvas.height = h;
		//随机数函数
		function fnRandom(min,max){
			return parseInt((max-min)*Math.random()+min+1)
		}
		function Round(){
			this.r = fnRandom(0,0);
			this.diam = this.r*2;
			//随机位置
			var x = fnRandom(0,canvas.width - this.r);
			this.x = x<this.r?this.r:x;
			var y = fnRandom(0,canvas.height-this.r);
			this.y = y<this.r?this.r:y
			//随机速度
			var speed = fnRandom(2,4)/10;
			this.speedX = fnRandom(0,4)>2.5?speed:-speed;
			this.speedY = fnRandom(0,4)>2.5?speed:-speed;
			//颜色
			
			this.color = "#ccc";
		}
		Round.prototype.draw = function(){
			//绘制函数
			ctx.fillStyle = this.color;
			ctx.beginPath()
			ctx.arc(this.x,this.y,this.r,0,Math.PI*2,true);
			ctx.closePath();
			ctx.fill();
		}
		Round.prototype.move = function(){
			
			if(this.x>canvas.width-this.r){
//				this.speedX*=-1;
				// this.x=this.r
				this.speedX*= -fnRandom(1,0); 
				
			}else if(this.x<this.r){
				// this.x=canvas.width-this.r
				this.speedX*=-fnRandom(1,0);
			}
			this.x+=this.speedX;
			
			if(this.y>canvas.height-this.r){
				this.speedY*= -fnRandom(1,0);
				// this.y=this.r
			}else if(this.y<this.r){
				// this.y=canvas.height-this.r
				this.speedY*=-fnRandom(1,0);
			}
			this.y+=this.speedY;
		}


		// function fix(allRound1,allRound2){
		// 	var dx = allRound1.x,
		// 	dy = allRound1.y,
		// 	dr = allRound1.r,
		// 	sx = allRound2.x,
		// 	sy = allRound2.y,
		// 	sr = allRound2.r,
		// 	l = Math.sqrt((dx-sx)*(dx-sx)+(dy-sy)*(dy-sy));
		// 	if(l<dr+sr){
		// 		allRound1.draw();
		// 		fix();
		// 	}
		// }
		//使用Round
		var allRound = [];
		function initRound(){
			//初始化30个圆形对象,放到数组中
			for(var i = 0 ; i<30;i++){
				var obj = new Round();
				allRound.push(obj);
				// if (allRound[i] && allRound[i+1])
				// fix(allRound[i],allRound[i+1]);
			}
		}
		initRound();
		var dxdy = []
		function roundMove(){
			ctx.clearRect(0,0,canvas.width,canvas.height);
			//遍历所有的圆形对象,让对象自己重绘,移动
			for (var i = 0 ;i <allRound.length;i++) {
				var round = allRound[i];
				round.draw();
				round.move();
				dxdy[i]={
					dx:round.x,
					dy:round.y,
					dr:round.r,
					dvx:round.speedX,
					dvy:round.speedY
				};
				var dx = dxdy[i].dx,
					dy =dxdy[i].dy,
					dr = dxdy[i].dr,
					dvx = dxdy[i].dvx,
					dvy = dxdy[i].dvy;
				
				for (var j=0;j<i;j++) {
					var roundOther = allRound[j];
					var sx = dxdy[j].dx,
						sy = dxdy[j].dy,
						sr = dxdy[j].dr,
						svx = dxdy[j].dvx,
						svy = dxdy[j].dvy;
				
						
					l = Math.sqrt((dx-sx)*(dx-sx)+(dy-sy)*(dy-sy));
					if (l < (dr+sr)) 
					{
						var x = round.speedX;
						var y = round.speedY;
						// if(x == roundOther.speedX && y == roundOther.speedY)
						// {
						// 	console.log(1);
						// 	var speed = fnRandom(2,4)/10;
						// 	round.speedX = fnRandom(0,4)>2.5?speed:-speed;
						// 	round.speedY = fnRandom(0,4)>2.5?speed:-speed;
						// 	roundOther.speedX = fnRandom(0,4)>2.5?speed:-speed;
						// 	roundOther.speedY = fnRandom(0,4)>2.5?speed:-speed;
						// } else{
							round.speedX = roundOther.speedX;
							round.speedY = roundOther.speedY;
							roundOther.speedX = x;
							roundOther.speedY = y;
						// }
					}
					var C = 1/l*7-0.007;
					var o = C > 0.03 ? 0.03 : C;
					ctx.strokeStyle = 'rgba(0,0,0,'+ o +')';
					ctx.beginPath();
					ctx.lineWidth=2;
					ctx.moveTo(dx,dy);
					ctx.lineTo(sx,sy);
					ctx.closePath();
					ctx.stroke();
				}
			}
			window.requestAnimationFrame(roundMove)
		}
		roundMove();
	</script>
</html>